[supervisord]
nodaemon=true
user=root
logfile=/app/logs/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/app/logs/

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
stdout_logfile=/app/logs/nginx.stdout.log
stderr_logfile=/app/logs/nginx.stderr.log
priority=10

[program:brain-api]
command=/opt/venv/bin/uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4 --log-level info --access-log
directory=/app
user=brain
autostart=true
autorestart=true
stdout_logfile=/app/logs/api.stdout.log
stderr_logfile=/app/logs/api.stderr.log
environment=PATH="/opt/venv/bin:%(ENV_PATH)s",PYTHONPATH="/app:%(ENV_PYTHONPATH)s"
priority=20

[program:brain-worker]
command=/opt/venv/bin/python -m workers.processor
directory=/app
user=brain
autostart=true
autorestart=true
stdout_logfile=/app/logs/worker.stdout.log
stderr_logfile=/app/logs/worker.stderr.log
environment=PATH="/opt/venv/bin:%(ENV_PATH)s",PYTHONPATH="/app:%(ENV_PYTHONPATH)s"
priority=30

[program:brain-scheduler]
command=/opt/venv/bin/python -m workers.scheduler
directory=/app
user=brain
autostart=true
autorestart=true
stdout_logfile=/app/logs/scheduler.stdout.log
stderr_logfile=/app/logs/scheduler.stderr.log
environment=PATH="/opt/venv/bin:%(ENV_PATH)s",PYTHONPATH="/app:%(ENV_PYTHONPATH)s"
priority=30

[group:brain]
programs=brain-api,brain-worker,brain-scheduler

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock