"use strict";(self.webpackChunkbrain_dashboard=self.webpackChunkbrain_dashboard||[]).push([[505],{8505:(e,t,s)=>{s.r(t),s.d(t,{default:()=>N});var a=s(5043),r=s(9379),l=s(5056);const n={chargeStrength:-300,linkDistance:100,linkStrength:.5,centerForce:.05,collisionRadius:30,nodeRadius:8,nodeMinRadius:4,nodeMaxRadius:20,edgeWidth:1,edgeOpacity:.6,zoomMin:.1,zoomMax:10,animationDuration:300,simulationAlpha:1,simulationAlphaDecay:.01,simulationVelocityDecay:.3,showLabels:!0,showEdgeLabels:!1,showLegend:!0,showMinimap:!1},o={document:"#3B82F6",entity:"#10B981",concept:"#8B5CF6",tag:"#F59E0B",folder:"#6B7280",edge:"#9CA3AF",selectedNode:"#DC2626",selectedEdge:"#DC2626",hoveredNode:"#059669",hoveredEdge:"#059669",background:"#111827",text:"#F3F4F6"};var d=s(2597),c=s(6319),i=s(5194),h=s(1816),x=s(5989),u=s(579);const m=e=>{let{onZoomIn:t,onZoomOut:s,onZoomReset:a,onRefresh:r,onSettingsClick:l,currentZoom:n}=e;return(0,u.jsxs)("div",{className:"flex flex-col bg-gray-800 rounded-lg shadow-lg p-2 space-y-2",children:[(0,u.jsx)("button",{onClick:t,className:"p-2 hover:bg-gray-700 rounded-md transition-colors group relative",title:"Zoom In",children:(0,u.jsx)(d.A,{className:"w-5 h-5 text-gray-300 group-hover:text-white"})}),(0,u.jsx)("button",{onClick:s,className:"p-2 hover:bg-gray-700 rounded-md transition-colors group relative",title:"Zoom Out",children:(0,u.jsx)(c.A,{className:"w-5 h-5 text-gray-300 group-hover:text-white"})}),(0,u.jsx)("button",{onClick:a,className:"p-2 hover:bg-gray-700 rounded-md transition-colors group relative",title:"Reset Zoom",children:(0,u.jsx)(i.A,{className:"w-5 h-5 text-gray-300 group-hover:text-white"})}),(0,u.jsx)("div",{className:"border-t border-gray-700 pt-2 mt-2",children:(0,u.jsxs)("div",{className:"text-xs text-gray-400 text-center mb-2",children:[(100*n).toFixed(0),"%"]})}),(0,u.jsx)("button",{onClick:r,className:"p-2 hover:bg-gray-700 rounded-md transition-colors group relative",title:"Refresh Graph",children:(0,u.jsx)(h.A,{className:"w-5 h-5 text-gray-300 group-hover:text-white"})}),l&&(0,u.jsx)("button",{onClick:l,className:"p-2 hover:bg-gray-700 rounded-md transition-colors group relative",title:"Graph Settings",children:(0,u.jsx)(x.A,{className:"w-5 h-5 text-gray-300 group-hover:text-white"})})]})};var g=s(7449),p=s(7591);const y=e=>{let{onSearch:t,placeholder:s="Search nodes and relationships...",debounceMs:r=300}=e;const[l,n]=(0,a.useState)(""),[o,d]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const e=setTimeout(()=>{t(l)},r);return()=>clearTimeout(e)},[l,t,r]);const c=(0,a.useCallback)(()=>{n(""),t("")},[t]),i=(0,a.useCallback)(()=>{d(!o),o?c():setTimeout(()=>{const e=document.getElementById("graph-search-input");null===e||void 0===e||e.focus()},100)},[o,c]);return(0,u.jsxs)("div",{className:"relative",children:[(0,u.jsxs)("div",{className:"flex items-center bg-gray-800 rounded-lg shadow-lg transition-all duration-300 ".concat(o?"w-64":"w-auto"),children:[(0,u.jsx)("button",{onClick:i,className:"p-3 hover:bg-gray-700 rounded-l-lg transition-colors",title:o?"Close search":"Open search",children:(0,u.jsx)(g.A,{className:"w-5 h-5 text-gray-300"})}),o&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("input",{id:"graph-search-input",type:"text",value:l,onChange:e=>n(e.target.value),placeholder:s,className:"flex-1 px-3 py-2 bg-transparent text-white placeholder-gray-400 focus:outline-none"}),l&&(0,u.jsx)("button",{onClick:c,className:"p-2 hover:bg-gray-700 rounded-r-lg transition-colors",title:"Clear search",children:(0,u.jsx)(p.A,{className:"w-4 h-4 text-gray-400"})})]})]}),o&&l&&(0,u.jsxs)("div",{className:"absolute top-full mt-2 w-64 bg-gray-800 rounded-lg shadow-lg p-2 z-10",children:[(0,u.jsx)("div",{className:"text-xs text-gray-400 mb-2",children:"Search filters:"}),(0,u.jsxs)("div",{className:"space-y-1",children:[(0,u.jsxs)("label",{className:"flex items-center text-sm text-gray-300 hover:bg-gray-700 p-1 rounded cursor-pointer",children:[(0,u.jsx)("input",{type:"checkbox",className:"mr-2",defaultChecked:!0}),"Nodes"]}),(0,u.jsxs)("label",{className:"flex items-center text-sm text-gray-300 hover:bg-gray-700 p-1 rounded cursor-pointer",children:[(0,u.jsx)("input",{type:"checkbox",className:"mr-2",defaultChecked:!0}),"Relationships"]}),(0,u.jsxs)("label",{className:"flex items-center text-sm text-gray-300 hover:bg-gray-700 p-1 rounded cursor-pointer",children:[(0,u.jsx)("input",{type:"checkbox",className:"mr-2"}),"Metadata"]})]})]})]})},f=()=>{const e=[{label:"Document",color:o.document,type:"node"},{label:"Entity",color:o.entity,type:"node"},{label:"Concept",color:o.concept,type:"node"},{label:"Tag",color:o.tag,type:"node"},{label:"Folder",color:o.folder,type:"node"}],t=[{label:"References",color:o.edge,type:"edge"},{label:"Selected",color:o.selectedNode,type:"node"}];return(0,u.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-lg p-4 space-y-3",children:[(0,u.jsx)("h3",{className:"text-sm font-semibold text-gray-300 mb-2",children:"Node Types"}),(0,u.jsx)("div",{className:"space-y-2",children:e.map(e=>(0,u.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,u.jsx)("div",{className:"w-4 h-4 rounded-full border-2 border-white",style:{backgroundColor:e.color}}),(0,u.jsx)("span",{className:"text-xs text-gray-400",children:e.label})]},e.label))}),(0,u.jsxs)("div",{className:"border-t border-gray-700 pt-3 mt-3",children:[(0,u.jsx)("h3",{className:"text-sm font-semibold text-gray-300 mb-2",children:"Interactions"}),(0,u.jsx)("div",{className:"space-y-2",children:t.map(e=>(0,u.jsxs)("div",{className:"flex items-center space-x-2",children:["edge"===e.type?(0,u.jsx)("div",{className:"w-4 h-0.5",style:{backgroundColor:e.color}}):(0,u.jsx)("div",{className:"w-4 h-4 rounded-full border-2",style:{backgroundColor:e.color,borderColor:e.color}}),(0,u.jsx)("span",{className:"text-xs text-gray-400",children:e.label})]},e.label))})]}),(0,u.jsxs)("div",{className:"border-t border-gray-700 pt-3 mt-3",children:[(0,u.jsx)("h3",{className:"text-sm font-semibold text-gray-300 mb-2",children:"Controls"}),(0,u.jsxs)("div",{className:"space-y-1 text-xs text-gray-400",children:[(0,u.jsx)("div",{children:"\u2022 Click: Select node"}),(0,u.jsx)("div",{children:"\u2022 Drag: Move node"}),(0,u.jsx)("div",{children:"\u2022 Scroll: Zoom"}),(0,u.jsx)("div",{children:"\u2022 Shift+Drag: Pan"})]})]})]})},v=e=>{var t,s,a,r;let{node:l,onClose:n}=e;return(0,u.jsxs)("div",{className:"bg-gray-800 rounded-lg shadow-lg p-4",children:[(0,u.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("h3",{className:"text-lg font-semibold text-white",children:l.label}),(0,u.jsx)("span",{className:"text-xs text-gray-400 capitalize",children:l.type})]}),(0,u.jsx)("button",{onClick:n,className:"p-1 hover:bg-gray-700 rounded transition-colors",children:(0,u.jsx)(p.A,{className:"w-5 h-5 text-gray-400"})})]}),(null===(t=l.metadata)||void 0===t?void 0:t.description)&&(0,u.jsxs)("div",{className:"mb-3",children:[(0,u.jsx)("h4",{className:"text-sm font-medium text-gray-300 mb-1",children:"Description"}),(0,u.jsx)("p",{className:"text-sm text-gray-400",children:l.metadata.description})]}),(0,u.jsxs)("div",{className:"space-y-3",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("h4",{className:"text-sm font-medium text-gray-300 mb-1",children:"Details"}),(0,u.jsxs)("dl",{className:"space-y-1",children:[(0,u.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,u.jsx)("dt",{className:"text-gray-400",children:"ID:"}),(0,u.jsxs)("dd",{className:"text-gray-300 font-mono text-xs",children:[l.id.substring(0,8),"..."]})]}),l.group&&(0,u.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,u.jsx)("dt",{className:"text-gray-400",children:"Group:"}),(0,u.jsx)("dd",{className:"text-gray-300",children:l.group})]}),(null===(s=l.metadata)||void 0===s?void 0:s.confidence)&&(0,u.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,u.jsx)("dt",{className:"text-gray-400",children:"Confidence:"}),(0,u.jsxs)("dd",{className:"text-gray-300",children:[(100*l.metadata.confidence).toFixed(1),"%"]})]}),(null===(a=l.metadata)||void 0===a?void 0:a.source)&&(0,u.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,u.jsx)("dt",{className:"text-gray-400",children:"Source:"}),(0,u.jsx)("dd",{className:"text-gray-300",children:l.metadata.source})]}),(null===(r=l.metadata)||void 0===r?void 0:r.extractedAt)&&(0,u.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,u.jsx)("dt",{className:"text-gray-400",children:"Extracted:"}),(0,u.jsx)("dd",{className:"text-gray-300",children:new Date(l.metadata.extractedAt).toLocaleDateString()})]})]})]}),l.metadata&&Object.keys(l.metadata).length>0&&(0,u.jsxs)("div",{children:[(0,u.jsx)("h4",{className:"text-sm font-medium text-gray-300 mb-1",children:"Metadata"}),(0,u.jsx)("div",{className:"bg-gray-900 rounded p-2 max-h-32 overflow-y-auto",children:(0,u.jsx)("pre",{className:"text-xs text-gray-400",children:JSON.stringify(Object.fromEntries(Object.entries(l.metadata).filter(e=>{let[t]=e;return!["description","confidence","source","extractedAt"].includes(t)})),null,2)})})]}),(0,u.jsx)("div",{className:"pt-3 border-t border-gray-700",children:(0,u.jsx)("button",{className:"w-full px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm",children:"View Related Documents"})})]})]})};var b=s(9274);const j=e=>{let{className:t="",initialFilters:s={},config:d={},onNodeSelect:c,onEdgeSelect:i}=e;const h=(0,a.useRef)(null),x=(0,a.useRef)(null),g=(0,a.useRef)(null),[p,j]=(0,a.useState)({width:800,height:600}),[N,w]=(0,a.useState)({selectedNodes:new Set,selectedEdges:new Set}),[k,S]=(0,a.useState)(s),[C,A]=(0,a.useState)(l.GSI),E=(0,r.A)((0,r.A)({},n),d),{data:R,loading:M,error:D,refetch:F}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[t,s]=(0,a.useState)(null),[r,l]=(0,a.useState)(!0),[n,o]=(0,a.useState)(null),d=(0,a.useCallback)(async()=>{l(!0),o(null);try{const t="/api/knowledge-graph";{const a=new URLSearchParams;e.searchQuery&&a.append("q",e.searchQuery),e.nodeTypes&&a.append("types",e.nodeTypes.join(",")),e.minConfidence&&a.append("min_confidence",e.minConfidence.toString());const r=await fetch("".concat(t,"?").concat(a));if(!r.ok)throw new Error("Failed to fetch graph data");const l=await r.json();s(l)}}catch(t){o(t instanceof Error?t.message:"An error occurred"),s(null)}finally{l(!1)}},[e]);return(0,a.useEffect)(()=>{d()},[d]),{data:(0,a.useMemo)(()=>{if(!t)return null;if(t.nodes.length>500){const e=[...t.nodes].sort((e,t)=>{var s,a;return((null===(s=t.metadata)||void 0===s?void 0:s.confidence)||0)-((null===(a=e.metadata)||void 0===a?void 0:a.confidence)||0)}).slice(0,500),s=new Set(e.map(e=>e.id));return{nodes:e,edges:t.edges.filter(e=>s.has("string"===typeof e.source?e.source:e.source.id)&&s.has("string"===typeof e.target?e.target:e.target.id)).slice(0,1e3)}}return t},[t]),loading:r,error:n,refetch:d}}(k);(0,a.useEffect)(()=>{const e=()=>{if(x.current){const{width:e,height:t}=x.current.getBoundingClientRect();j({width:e,height:t})}};e();const t=new ResizeObserver(e);return x.current&&t.observe(x.current),()=>t.disconnect()},[]),(0,a.useEffect)(()=>{if(!h.current||!R||M)return;const e=l.Ltv(h.current);e.selectAll("*").remove();const t=e.append("g").attr("class","graph-container"),s=l.s_O().scaleExtent([E.zoomMin||.1,E.zoomMax||10]).on("zoom",e=>{t.attr("transform",e.transform),A(e.transform)});e.call(s);e.append("defs").append("marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",20).attr("refY",0).attr("markerWidth",8).attr("markerHeight",8).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill",o.edge);const a=l.tXi(R.nodes).force("link",l.kJC(R.edges).id(e=>e.id).distance(E.linkDistance||100).strength(E.linkStrength||.5)).force("charge",l.xJS().strength(E.chargeStrength||-300)).force("center",l.jTM(p.width/2,p.height/2).strength(E.centerForce||.05)).force("collision",l.eRw().radius(E.collisionRadius||30));g.current=a;const n=t.append("g").attr("class","edges").selectAll("line").data(R.edges).join("line").attr("stroke",o.edge).attr("stroke-width",e=>Math.sqrt(e.weight||1)).attr("stroke-opacity",E.edgeOpacity||.6).attr("marker-end","url(#arrow)").on("click",(e,t)=>{e.stopPropagation(),z(t)}).on("mouseenter",(e,t)=>{w(e=>(0,r.A)((0,r.A)({},e),{},{hoveredEdge:t.id}))}).on("mouseleave",()=>{w(e=>(0,r.A)((0,r.A)({},e),{},{hoveredEdge:void 0}))}),d=t.append("g").attr("class","nodes").selectAll("circle").data(R.nodes).join("circle").attr("r",e=>L(e)).attr("fill",e=>O(e)).attr("stroke","#fff").attr("stroke-width",2).style("cursor","pointer").on("click",(e,t)=>{e.stopPropagation(),Z(t)}).on("mouseenter",(e,t)=>{w(e=>(0,r.A)((0,r.A)({},e),{},{hoveredNode:t.id})),B(e,t)}).on("mouseleave",()=>{w(e=>(0,r.A)((0,r.A)({},e),{},{hoveredNode:void 0})),T()}).call(l.$Er().on("start",function(e,t){e.active||a.alphaTarget(.3).restart();t.fx=t.x,t.fy=t.y}).on("drag",function(e,t){t.fx=e.x,t.fy=e.y}).on("end",function(e,t){e.active||a.alphaTarget(0);t.fx=null,t.fy=null}));if(E.showLabels){const e=t.append("g").attr("class","labels").selectAll("text").data(R.nodes).join("text").text(e=>e.label).attr("font-size",12).attr("fill",o.text).attr("text-anchor","middle").attr("dy",-15).style("pointer-events","none").style("user-select","none");a.on("tick.labels",()=>{e.attr("x",e=>e.x||0).attr("y",e=>e.y||0)})}return a.on("tick",()=>{n.attr("x1",e=>e.source.x||0).attr("y1",e=>e.source.y||0).attr("x2",e=>e.target.x||0).attr("y2",e=>e.target.y||0),d.attr("cx",e=>e.x||0).attr("cy",e=>e.y||0)}),()=>{a.stop()}},[R,p,E,M]);const L=e=>{var t;const s=E.nodeRadius||8,a=(null===(t=e.metadata)||void 0===t?void 0:t.confidence)||1;return Math.max(E.nodeMinRadius||4,Math.min(E.nodeMaxRadius||20,s*a))},O=e=>N.selectedNodes.has(e.id)?o.selectedNode:N.hoveredNode===e.id?o.hoveredNode:o[e.type]||o.entity,Z=(0,a.useCallback)(e=>{w(t=>{const s=new Set(t.selectedNodes);return s.has(e.id)?s.delete(e.id):s.add(e.id),(0,r.A)((0,r.A)({},t),{},{selectedNodes:s})}),null===c||void 0===c||c(e)},[c]),z=(0,a.useCallback)(e=>{w(t=>{const s=new Set(t.selectedEdges);return s.has(e.id)?s.delete(e.id):s.add(e.id),(0,r.A)((0,r.A)({},t),{},{selectedEdges:s})}),null===i||void 0===i||i(e)},[i]),B=(e,t)=>{console.log("Show tooltip for",t)},T=()=>{};if(M)return(0,u.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,u.jsx)(b.A,{})});if(D)return(0,u.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,u.jsxs)("div",{className:"text-red-500",children:["Error loading graph data: ",D]})});const I=null===R||void 0===R?void 0:R.nodes.find(e=>N.selectedNodes.has(e.id));return(0,u.jsxs)("div",{ref:x,className:"relative w-full h-full bg-gray-900 ".concat(t),children:[(0,u.jsx)("svg",{ref:h,width:p.width,height:p.height,className:"w-full h-full"}),(0,u.jsxs)("div",{className:"absolute top-4 left-4 space-y-4",children:[(0,u.jsx)(y,{onSearch:e=>{S(t=>(0,r.A)((0,r.A)({},t),{},{searchQuery:e}))}}),(0,u.jsx)(m,{onZoomIn:()=>{if(!h.current)return;l.Ltv(h.current).transition().duration(300).call(l.s_O().scaleBy,1.3)},onZoomOut:()=>{if(!h.current)return;l.Ltv(h.current).transition().duration(300).call(l.s_O().scaleBy,.7)},onZoomReset:()=>{if(!h.current)return;l.Ltv(h.current).transition().duration(300).call(l.s_O().transform,l.GSI)},onRefresh:()=>{F()},currentZoom:C.k})]}),E.showLegend&&(0,u.jsx)("div",{className:"absolute top-4 right-4",children:(0,u.jsx)(f,{})}),I&&(0,u.jsx)("div",{className:"absolute bottom-4 right-4 w-80",children:(0,u.jsx)(v,{node:I,onClose:()=>w(e=>(0,r.A)((0,r.A)({},e),{},{selectedNodes:new Set}))})})]})},N=()=>(0,u.jsx)("div",{className:"h-screen bg-gray-900",children:(0,u.jsxs)("div",{className:"h-full flex flex-col",children:[(0,u.jsxs)("div",{className:"bg-gray-800 border-b border-gray-700 px-6 py-4",children:[(0,u.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Knowledge Graph Explorer"}),(0,u.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Interactive visualization of document relationships and extracted entities"})]}),(0,u.jsx)("div",{className:"flex-1 relative",children:(0,u.jsx)(j,{className:"w-full h-full",onNodeSelect:e=>{console.log("Node selected:",e)},onEdgeSelect:e=>{console.log("Edge selected:",e)},config:{showLabels:!0,showLegend:!0,nodeRadius:8,chargeStrength:-400,linkDistance:120}})}),(0,u.jsx)("div",{className:"bg-gray-800 border-t border-gray-700 px-6 py-2",children:(0,u.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-400",children:[(0,u.jsxs)("div",{children:["Press ",(0,u.jsx)("kbd",{className:"px-2 py-1 bg-gray-700 rounded",children:"Space"})," to pause simulation"]}),(0,u.jsx)("div",{children:"Use mouse wheel to zoom \u2022 Click and drag to pan \u2022 Click nodes to select"})]})})]})})}}]);
//# sourceMappingURL=505.08fe2f9c.chunk.js.map